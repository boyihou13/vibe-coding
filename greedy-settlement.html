<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>Greedy Settlement è¨ˆç®—å™¨</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 700px; margin: auto; }
    textarea, button { width: 100%; margin-top: 10px; font-size: 1em; }
    pre { background: #f5f5f5; padding: 10px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h2>ğŸ’° Greedy Settlement çµç®—å·¥å…·</h2>
  <p>è«‹è¼¸å…¥æ¯å€‹äººçš„æ·¨é¡ï¼ˆæ ¼å¼ï¼š<code>åç¨±,é‡‘é¡</code> æ¯è¡Œä¸€äººï¼‰</p>
  <textarea id="input" rows="8"></textarea>
  <button onclick="settle()">åŸ·è¡Œçµç®—</button>
  <h3>ğŸ“„ çµç®—å»ºè­°ï¼š</h3>
  <pre id="output"></pre>

  <script>
    function settle() {
      const input = document.getElementById("input").value.trim();
      const lines = input.split("\n");
      const balances = [];

      // è§£æè¼¸å…¥
      for (const line of lines) {
        const parts = line.split(",");
        if (parts.length !== 2) {
          alert("æ ¼å¼éŒ¯èª¤ï¼šæ¯è¡Œå¿…é ˆæœ‰å…©æ¬„ï¼ˆåç¨±,é‡‘é¡ï¼‰ï¼š\n" + line);
          return;
        }
        const [nameRaw, valueRaw] = parts;
        const name = nameRaw.trim();
        const value = valueRaw.trim();
        const amount = parseFloat(value);
        if (!name || isNaN(amount)) {
          alert("æ ¼å¼éŒ¯èª¤ï¼šåç¨±æˆ–é‡‘é¡ç„¡æ•ˆï¼š\n" + line);
          return;
        }
        if (Math.abs(amount) > 0.01) {
          balances.push({ name, amount: Math.round(amount * 100) / 100 });
        }
      }
      // æ–°å¢ï¼šæª¢æŸ¥æ‰€æœ‰é‡‘é¡ç¸½å’Œæ˜¯å¦ç‚º 0
      const total = balances.reduce((sum, p) => sum + p.amount, 0);
      if (Math.abs(total) > 0.01) {
        alert("éŒ¯èª¤ï¼šæ‰€æœ‰æ·¨é¡çš„ç¸½å’Œå¿…é ˆç‚º 0ï¼Œç›®å‰ç¸½å’Œç‚º " + total.toFixed(2));
        return;
      }

      // åˆ†é›¢æ­£ã€è² é¤˜é¡
      const creditors = balances.filter(p => p.amount > 0).sort((a, b) => b.amount - a.amount);
      const debtors = balances.filter(p => p.amount < 0).sort((a, b) => a.amount - b.amount);

      const result = [];

      // Greedy settlement
      let i = 0, j = 0;
      while (i < debtors.length && j < creditors.length) {
        const debtor = debtors[i];
        const creditor = creditors[j];
        const amount = Math.min(creditor.amount, -debtor.amount);
        
        result.push(`${debtor.name} âœ ${creditor.name}ï¼š$${amount.toFixed(2)}`);

        debtor.amount += amount;
        creditor.amount -= amount;

        if (Math.abs(debtor.amount) < 0.01) i++;
        if (Math.abs(creditor.amount) < 0.01) j++;
      }

      document.getElementById("output").textContent = result.length > 0
        ? result.join("\n")
        : "ä¸éœ€è¦ä»»ä½•è½‰å¸³ï¼Œå·²ç¶“å¹³è¡¡ âœ…";
    }
  </script>
</body>
</html>